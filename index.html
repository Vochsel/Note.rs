<!DOCTYPE html>
<html>
<head>
	<title>Note</title>
	<link rel="stylesheet" type="text/css" href="css/styles.css">
	<link href='https://fonts.googleapis.com/css?family=Josefin+Slab:400,700,100,300' rel='stylesheet' type='text/css'>
	<script type="text/javascript" src="js/keybind.js"></script>
</head>
<body>
	<div id="header">
		<div id="splash">Note.rs</div>
		<div id="tagSelect">
			<a id="tagGlyph">#</a><a id="tagText" contentEditable="true">ExamPrep</a></div>
			<hr>
		</div>
	<textarea id="note" cols="100" rows="100"></textarea>



	<script type="text/javascript">

	var storage = localStorage;

	var Preferences = {
		lastTag: "Default"
	};

	var tag_DOM = document.getElementById("tag_text");
	var note_DOM = document.getElementById("note");


	key.bind.add("k", {ctrl: true}, function(e) {
		console.log("K pressed")
	});

	var current_note = CreateNote("Default");

	// Tag editing
	tag_DOM.addEventListener('input', function(evt) {
		var value = evt.target.innerHTML;

		Preferences.lastTag = value;						//Store last tag entered
		StorePrefs(Preferences);
		current_note = RetrieveNote(value);					//Load note by tag
		note_DOM.value = current_note.text;					//Show new note
		document.title = "Note.rs : " + current_note.tag;	//Update title
		console.log(current_note.tag);
	});

	// Note editing

	note_DOM.addEventListener('input', function(evt) {
		var value = evt.target.value;

		current_note.text = value;	//Change current note
		StoreNote(current_note);	//Store current note
	});

	window.onload = function(e) {
		/*if(storage.getItem("lastTag") == null) {
			storage.setItem("lastTag", "MyFirstNote");
			storage.setItem("MyFirstNote", "Welcome! Please feel free to write a note :D");
		}*/

		if(Preferences.lastTag == null) {
			StorePrefs(Preferences);
		}

		// Load preferences
		Preferences = RetrievePrefs();

		//current_note = RetrieveNote(Preferences.lastTag);
		
		tag_DOM.innerHTML = current_note.tag;
		note_DOM.value = current_note.text;
		document.title = "Note.rs : " + tag;

		console.log('hey');
	};


	function CreateNote(tag) {
		return {
			tag: tag,
			text: "blank"
		}
	}

	function StoreNote(note) {
		storage.setItem("note_" + note.tag, JSON.stringify(note));
	}

	function RetrieveNote(tag) {
		return JSON.parse(storage.getItem("note_" + tag));
	}

	function StorePrefs(prefs) {
		storage.setItem("prefs", JSON.stringify(Preferences));
	}

	function RetrievePrefs() {
		storage.getItem("prefs");
	}

	</script>
	</body>
</html>

<!--

50 marks total

5 short questions
 - 2 questions development life cycles
 - 3 questions on project management

Must pass the exam, need 25 marks+

-->